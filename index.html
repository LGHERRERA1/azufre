<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infografía Consolidada: Compras de Azufre 2024-2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        /* Nueva paleta de colores */
        :root {
            --light-lime: #d9ed92;
            --lime-green: #b5e48c;
            --green: #99d98c;
            --medium-green: #76c893;
            --teal-green: #52b69a;
            --teal-blue: #34a0a4;
            --medium-blue: #168aad;
            --blue: #1a759f;
            --dark-blue: #1e6091;
            --very-dark-blue: #184e77;
        }

        /* Animación para las barras del gráfico */
        .chart-bar-stack {
            transition: all 0.3s ease-in-out;
        }
        .chart-item:hover .chart-bar-stack {
            filter: brightness(1.1);
        }
        
        .price-line-chart-point {
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .price-line-chart-point:hover {
            r: 8;
            filter: brightness(1.2);
        }

        /* Estilo y animación para los gráficos de torta */
        .pie-chart {
            width: 150px;
            height: 150px;
            position: relative;
            display: inline-grid;
            place-content: center;
            font-size: 1.25rem;
            font-weight: bold;
        }
        .pie-chart:before {
            content: "";
            position: absolute;
            border-radius: 50%;
            inset: 0;
            background: conic-gradient(var(--c1) calc(var(--p) * 1%), var(--c2) 0);
            transition: all 0.5s;
        }
        
        /* Estilo para el tooltip del gráfico */
        #chart-tooltip {
            position: absolute;
            background-color: rgba(24, 78, 119, 0.95); /* --very-dark-blue */
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
            transform: translate(-50%, -125%);
            white-space: nowrap;
            z-index: 50;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .highlight-stat {
            color: var(--light-lime);
            font-weight: 700;
        }

        .metric-card-interactive {
            transition: all 0.3s ease-in-out;
        }
        .metric-card-interactive:hover {
            transform: scale(1.06);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.15), 0 8px 10px -6px rgb(0 0 0 / 0.15);
            background-color: var(--light-lime);
        }
        .metric-card-interactive:hover .metric-number,
        .metric-card-interactive:hover .metric-unit {
             color: var(--very-dark-blue);
        }
         .metric-card-interactive:hover .metric-label {
             color: var(--dark-blue);
        }

        .conclusion-item {
            background-color: var(--dark-blue);
            transition: all 0.3s ease;
        }
        .conclusion-item:hover {
            background-color: var(--blue);
            transform: translateY(-8px) scale(1.08);
            box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.35);
        }

        .pie-chart-card {
            transition: all 0.3s ease-in-out;
        }
        .pie-chart-card:hover {
            transform: scale(1.08);
            box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25);
            background-color: #eef2f7;
            background-image: radial-gradient(rgba(30, 96, 145, 0.25) 0.5px, transparent 0.5px);
            background-size: 2px 2px;
        }
        .pie-chart-card .pie-card-title {
            transition: all 0.3s ease-in-out;
        }
        .pie-chart-card:hover .pie-card-title {
            transform: scale(1.1);
            color: var(--very-dark-blue);
            font-weight: 800;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Tooltip para el gráfico -->
    <div id="chart-tooltip"></div>

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <!-- Encabezado -->
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold" style="color: var(--very-dark-blue);">Análisis Consolidado de Compras de Azufre</h1>
            <p class="text-lg md:text-xl mt-2" style="color: var(--blue);">Periodo: Enero 2024 - Agosto 2025</p>
        </header>

        <!-- Métricas Comparativas -->
        <section class="mb-16">
            <h2 class="text-3xl font-bold text-center mb-8" style="color: var(--blue);">Métricas Comparativas</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                <!-- Métricas 2024 -->
                <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                    <h3 class="text-2xl font-bold text-center mb-6" style="color: var(--dark-blue);">Año 2024</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                        <div class="bg-gray-50 p-4 rounded-lg text-center metric-card-interactive">
                            <h4 class="font-semibold text-gray-600 metric-label">Total Comprado</h4>
                            <p class="text-3xl font-bold metric-number" style="color: var(--dark-blue);">28,697 <span class="text-xl metric-unit">Ton</span></p>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg text-center metric-card-interactive">
                            <h4 class="font-semibold text-gray-600 metric-label">Promedio Mensual</h4>
                            <p class="text-3xl font-bold metric-number" style="color: var(--dark-blue);">2,391 <span class="text-xl metric-unit">Ton/Mes</span></p>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg text-center metric-card-interactive">
                            <h4 class="font-semibold text-gray-600 metric-label">Prom. Precio Contrato</h4>
                            <p class="text-3xl font-bold metric-number" style="color: var(--dark-blue);">$483 <span class="text-xl metric-unit">/ KG</span></p>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg text-center metric-card-interactive">
                            <h4 class="font-semibold text-gray-600 metric-label">Prom. Precio Export.</h4>
                            <p class="text-3xl font-bold metric-number" style="color: var(--dark-blue);">$220 <span class="text-xl metric-unit">/ KG</span></p>
                        </div>
                    </div>
                </div>
                <!-- Métricas 2025 -->
                <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                    <h3 class="text-2xl font-bold text-center mb-6" style="color: var(--dark-blue);">2025 (Ene-Ago)</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                         <div class="bg-gray-50 p-4 rounded-lg text-center metric-card-interactive">
                            <h4 class="font-semibold text-gray-600 metric-label">Total Comprado</h4>
                            <p class="text-3xl font-bold metric-number" style="color: var(--dark-blue);">19,584 <span class="text-xl metric-unit">Ton</span></p>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg text-center metric-card-interactive">
                            <h4 class="font-semibold text-gray-600 metric-label">Promedio Mensual</h4>
                            <p class="text-3xl font-bold metric-number" style="color: var(--dark-blue);">2,448 <span class="text-xl metric-unit">Ton/Mes</span></p>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg text-center metric-card-interactive">
                            <h4 class="font-semibold text-gray-600 metric-label">Prom. Precio Contrato</h4>
                            <p class="text-3xl font-bold metric-number" style="color: var(--dark-blue);">$956 <span class="text-xl metric-unit">/ KG</span></p>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg text-center metric-card-interactive">
                            <h4 class="font-semibold text-gray-600 metric-label">Prom. Precio Export.</h4>
                            <p class="text-3xl font-bold metric-number" style="color: var(--dark-blue);">$384 <span class="text-xl metric-unit">/ KG</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Gráfico 1: Volumen de Compra Mensual -->
        <section class="mb-16 bg-white p-6 rounded-xl shadow-lg border border-gray-200 overflow-x-auto">
            <h2 class="text-3xl font-bold text-center mb-2" style="color: var(--blue);">Volumen de Compra Mensual (2024-2025)</h2>
            <p class="text-center text-gray-600 mb-8">Desglose de toneladas por tipo de compra</p>
            <div id="volume-chart-container" class="w-full relative pt-4 pb-2" style="min-width: 800px;">
                <div class="h-64 relative">
                    <div class="absolute top-0 left-0 h-full flex flex-col justify-between text-sm text-gray-500 -ml-3">
                        <span class="absolute top-0 transform -translate-y-1/2">4000</span>
                        <span class="absolute" style="top: 25%; transform: translateY(-50%);">3000</span>
                        <span class="absolute top-1/2 transform -translate-y-1/2">2000</span>
                        <span class="absolute" style="top: 75%; transform: translateY(-50%);">1000</span>
                        <span class="absolute bottom-0 transform translate-y-1/2">0</span>
                    </div>
                    <div class="h-full border-b-2 border-l-2 border-r-2 border-gray-300 ml-8 relative">
                        <!-- Fondos de año -->
                        <div class="absolute top-0 left-0 h-full w-full flex z-0">
                            <div class="h-full" style="width: 60%; background-color: #f9fafb;"></div>
                            <div class="h-full relative" style="width: 40%; background-color: #f3f4f6;">
                                <svg class="w-full h-full absolute top-0 left-0" preserveAspectRatio="none">
                                    <defs>
                                        <pattern id="dense-texture-2025" patternUnits="userSpaceOnUse" width="3" height="3">
                                            <circle cx="1.5" cy="1.5" r="1.2" fill="rgba(113, 128, 150, 0.25)"></circle>
                                        </pattern>
                                    </defs>
                                    <rect x="0" y="0" width="100%" height="100%" fill="url(#dense-texture-2025)" />
                                </svg>
                            </div>
                        </div>
                        <!-- Contenedor de las barras -->
                        <div id="volume-bars-container" class="relative z-10 h-full flex justify-around items-end">
                           <!-- Las barras se generarán con JS -->
                        </div>
                    </div>
                </div>
                <div class="w-full flex ml-8 mt-1">
                    <div class="text-center font-bold text-base py-1 rounded-l-md" style="width: 60%; background-color: #e5e7eb; color: #4b5563;">2024</div>
                    <div class="text-center font-bold text-base py-1 rounded-r-md relative" style="width: 40%; background-color: #d1d5db; color: #4b5563;">
                        <svg class="w-full h-full absolute top-0 left-0" preserveAspectRatio="none">
                            <defs>
                                <pattern id="dense-texture-2025-franja" patternUnits="userSpaceOnUse" width="3" height="3">
                                    <circle cx="1.5" cy="1.5" r="1.2" fill="rgba(113, 128, 150, 0.25)"></circle>
                                </pattern>
                            </defs>
                            <rect x="0" y="0" width="100%" height="100%" fill="url(#dense-texture-2025-franja)" />
                        </svg>
                        <span class="relative z-10">2025</span>
                    </div>
                </div>
            </div>
             <div class="flex justify-center flex-wrap mt-6 space-x-4">
                <div class="flex items-center"><div class="w-4 h-4 rounded-sm mr-2" style="background-color: var(--teal-green);"></div><span class="text-sm text-gray-600">Contrato Barranca</span></div>
                <div class="flex items-center"><div class="w-4 h-4 rounded-sm mr-2" style="background-color: var(--green);"></div><span class="text-sm text-gray-600">Contrato Reficar</span></div>
                <div class="flex items-center"><div class="w-4 h-4 rounded-sm mr-2" style="background-color: var(--light-lime);"></div><span class="text-sm text-gray-600">Exportación</span></div>
            </div>
        </section>

        <!-- Gráfico 2: Evolución de Precios por Tipo -->
        <section class="mb-16 bg-white p-6 rounded-xl shadow-lg border border-gray-200 overflow-x-auto">
            <h2 class="text-3xl font-bold text-center mb-2" style="color: var(--blue);">Evolución de Precios por Tipo (2024-2025)</h2>
            <p class="text-center text-gray-600 mb-8">Comparativo de precios (COP/KG) para Contrato y Exportación</p>
            <div id="price-chart-container" class="w-full relative pt-4 pb-2" style="min-width: 800px;">
                <div class="h-72 relative">
                    <div class="absolute top-0 left-0 h-full flex flex-col justify-between text-sm text-gray-500 -ml-3">
                        <span class="absolute top-0 transform -translate-y-1/2">$1200</span>
                        <span class="absolute top-1/4 transform -translate-y-1/2">$900</span>
                        <span class="absolute top-1/2 transform -translate-y-1/2">$600</span>
                        <span class="absolute top-3/4 transform -translate-y-1/2">$300</span>
                        <span class="absolute bottom-0 transform translate-y-1/2">$0</span>
                    </div>
                    <div class="h-full border-b-2 border-l-2 border-r-2 border-gray-300 ml-8 relative">
                        <!-- Fondos de año -->
                        <div class="absolute top-0 left-0 h-full w-full flex z-0">
                            <div class="h-full" style="width: 60%; background-color: #f9fafb;"></div>
                            <div class="h-full relative" style="width: 40%; background-color: #f3f4f6;">
                                <svg class="w-full h-full absolute top-0 left-0" preserveAspectRatio="none">
                                    <defs>
                                        <pattern id="dense-texture-price" patternUnits="userSpaceOnUse" width="3" height="3">
                                            <circle cx="1.5" cy="1.5" r="1.2" fill="rgba(113, 128, 150, 0.25)"></circle>
                                        </pattern>
                                    </defs>
                                    <rect x="0" y="0" width="100%" height="100%" fill="url(#dense-texture-price)" />
                                </svg>
                            </div>
                        </div>
                        <svg id="price-chart-svg" class="w-full h-full absolute top-0 left-0 z-10" preserveAspectRatio="none">
                            <g id="price-chart-content"></g>
                        </svg>
                    </div>
                     <div class="absolute top-0 right-0 h-full flex flex-col justify-between text-sm text-gray-500 -mr-3">
                        <span class="absolute top-0 transform -translate-y-1/2">$1200</span>
                        <span class="absolute top-1/4 transform -translate-y-1/2">$900</span>
                        <span class="absolute top-1/2 transform -translate-y-1/2">$600</span>
                        <span class="absolute top-3/4 transform -translate-y-1/2">$300</span>
                        <span class="absolute bottom-0 transform translate-y-1/2">$0</span>
                    </div>
                </div>
                <div class="w-full flex ml-8 mt-1">
                     <div class="text-center font-bold text-base py-1 rounded-l-md" style="width: 60%; background-color: #e5e7eb; color: #4b5563;">2024</div>
                    <div class="text-center font-bold text-base py-1 rounded-r-md relative" style="width: 40%; background-color: #d1d5db; color: #4b5563;">
                         <svg class="w-full h-full absolute top-0 left-0" preserveAspectRatio="none">
                            <defs>
                                <pattern id="dense-texture-price-franja" patternUnits="userSpaceOnUse" width="3" height="3">
                                    <circle cx="1.5" cy="1.5" r="1.2" fill="rgba(113, 128, 150, 0.25)"></circle>
                                </pattern>
                            </defs>
                            <rect x="0" y="0" width="100%" height="100%" fill="url(#dense-texture-price-franja)" />
                        </svg>
                        <span class="relative z-10">2025</span>
                    </div>
                </div>
                 <div id="price-chart-labels" class="w-full flex justify-around items-end ml-8 mt-2">
                    <!-- Labels will be generated by JS -->
                </div>
            </div>
            <div class="flex justify-center flex-wrap mt-6 space-x-4">
                <div class="flex items-center"><div class="w-4 h-4 rounded-sm mr-2" style="background-color: var(--dark-blue);"></div><span class="text-sm text-gray-600">Precio Contrato</span></div>
                <div class="flex items-center"><div class="w-4 h-4 rounded-sm mr-2" style="background-color: var(--medium-green);"></div><span class="text-sm text-gray-600">Precio Exportación</span></div>
                <div class="flex items-center"><div class="w-4 h-4 rounded-sm mr-2" style="background-color: var(--teal-blue);"></div><span class="text-sm text-gray-600">Precio Promedio ponderado de compra</span></div>
            </div>
        </section>

        <!-- Distribución Consolidada -->
        <section class="mb-16">
            <h2 class="text-3xl font-bold text-center mb-8" style="color: var(--blue);">Distribución Comparativa</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 text-center pie-chart-card">
                    <h3 class="text-xl font-semibold mb-4 pie-card-title">Distribución 2024</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                             <h4 class="font-semibold text-gray-700 mb-2">Por Planta</h4>
                            <div class="pie-chart mx-auto" style="--p:63.2; --c1: var(--teal-green); --c2: var(--lime-green);"></div>
                            <div class="text-xs mt-2 text-left"><div class="flex items-center"><span class="w-3 h-3 rounded-sm mr-2" style="background-color: var(--teal-green);"></span>Barranca: 63.2%</div><div class="flex items-center"><span class="w-3 h-3 rounded-sm mr-2" style="background-color: var(--lime-green);"></span>Reficar: 36.8%</div></div>
                        </div>
                        <div>
                             <h4 class="font-semibold text-gray-700 mb-2">Por Tipo</h4>
                            <div class="pie-chart mx-auto" style="--p:89.1; --c1: var(--medium-blue); --c2: var(--light-lime);"></div>
                            <div class="text-xs mt-2 text-left"><div class="flex items-center"><span class="w-3 h-3 rounded-sm mr-2" style="background-color: var(--medium-blue);"></span>Contrato: 89.1%</div><div class="flex items-center"><span class="w-3 h-3 rounded-sm mr-2" style="background-color: var(--light-lime);"></span>Export: 10.9%</div></div>
                        </div>
                    </div>
                </div>
                 <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 text-center pie-chart-card">
                    <h3 class="text-xl font-semibold mb-4 pie-card-title">Distribución 2025 (Ene-Ago)</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                             <h4 class="font-semibold text-gray-700 mb-2">Por Planta</h4>
                            <div class="pie-chart mx-auto" style="--p:58.2; --c1: var(--teal-green); --c2: var(--lime-green);"></div>
                            <div class="text-xs mt-2 text-left"><div class="flex items-center"><span class="w-3 h-3 rounded-sm mr-2" style="background-color: var(--teal-green);"></span>Barranca: 58.2%</div><div class="flex items-center"><span class="w-3 h-3 rounded-sm mr-2" style="background-color: var(--lime-green);"></span>Reficar: 41.8%</div></div>
                        </div>
                        <div>
                             <h4 class="font-semibold text-gray-700 mb-2">Por Tipo</h4>
                            <div class="pie-chart mx-auto" style="--p:61.8; --c1: var(--medium-blue); --c2: var(--light-lime);"></div>
                            <div class="text-xs mt-2 text-left"><div class="flex items-center"><span class="w-3 h-3 rounded-sm mr-2" style="background-color: var(--medium-blue);"></span>Contrato: 61.8%</div><div class="flex items-center"><span class="w-3 h-3 rounded-sm mr-2" style="background-color: var(--light-lime);"></span>Export: 38.2%</div></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Conclusiones -->
        <section class="p-8 rounded-xl shadow-2xl" style="background-color: var(--very-dark-blue); color: #fff;">
            <h2 class="text-3xl font-bold text-center mb-6">Conclusiones Clave del Periodo</h2>
            <ul class="space-y-4 list-inside max-w-3xl mx-auto">
                <li class="flex items-start p-3 rounded-lg conclusion-item"><svg class="w-6 h-6 mr-4 mt-1 flex-shrink-0" style="color: var(--medium-green);" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg><span><strong class="font-semibold">Cambio Estratégico en 2025:</strong> Se observa un cambio significativo en la estrategia de compra, aumentando drásticamente la participación de las compras de Exportación del <span class="highlight-stat">~11%</span> en 2024 a un <span class="highlight-stat">~38%</span> en lo que va de 2025, aprovechando su menor costo.</span></li>
                <li class="flex items-start p-3 rounded-lg conclusion-item"><svg class="w-6 h-6 mr-4 mt-1 flex-shrink-0" style="color: var(--medium-green);" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg><span><strong class="font-semibold">Tendencia Alcista en Precios:</strong> Ambos tipos de precio muestran una clara tendencia al alza, siendo más pronunciada en los precios de Contrato, que se han más que duplicado desde inicios de 2024.</span></li>
                <li class="flex items-start p-3 rounded-lg conclusion-item"><svg class="w-6 h-6 mr-4 mt-1 flex-shrink-0" style="color: var(--medium-green);" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg><span><strong class="font-semibold">Volumen Variable:</strong> El volumen de compra mensual es volátil, con un pico de <span class="highlight-stat">3,810 Ton</span> (Ago-25) y un mínimo de <span class="highlight-stat">1,462 Ton</span> (Nov-24).</span></li>
                 <li class="flex items-start p-3 rounded-lg conclusion-item"><svg class="w-6 h-6 mr-4 mt-1 flex-shrink-0" style="color: var(--medium-green);" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg><span><strong class="font-semibold">Alternativa de Exportación:</strong> A pesar de su tendencia al alza, los precios de exportación (prom. <span class="highlight-stat">$319/KG</span>) siguen representando un ahorro de más del 50% frente a los precios de contrato (prom. <span class="highlight-stat">$603/KG</span>).</span></li>
            </ul>
        </section>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- GRÁFICO DE VOLUMEN ---
            const volumeData = {
                labels: ["Ene-24", "Feb-24", "Mar-24", "Abr-24", "May-24", "Jun-24", "Jul-24", "Ago-24", "Sep-24", "Oct-24", "Nov-24", "Dic-24", "Ene-25", "Feb-25", "Mar-25", "Abr-25", "May-25", "Jun-25", "Jul-25", "Ago-25"],
                c1: [1735, 1530, 1389, 1456, 1552, 1268, 1688, 1799, 1494, 1365, 1259, 1365, 1499, 1084, 887, 1528, 1546, 1579, 1598, 1610],
                c2: [591, 337, 1133, 1133, 758, 204, 882, 390, 937, 623, 203, 211, 209, 202, 206, 0, 0, 0, 0, 0],
                c3: [0, 0, 0, 0, 478, 0, 205, 576, 407, 741, 0, 688, 1169, 835, 997, 610, 615, 586, 1568, 2200],
                total: [2327, 1867, 2522, 2589, 2788, 1472, 2775, 2765, 2837, 2729, 1462, 2264, 2877, 2121, 2091, 2138, 2161, 2165, 3166, 3810],
                avgPrice: [437, 410, 415, 435, 391, 430, 408, 415, 535, 527, 619, 519, 586, 586, 542, 810, 915, 949, 757, 720]
            };
            
            const yMaxVolume = 4000;
            const volumeBarsContainer = document.getElementById('volume-bars-container');
            volumeData.labels.forEach((label, i) => {
                const total = volumeData.total[i];
                const c1 = volumeData.c1[i];
                const c2 = volumeData.c2[i];
                const c3 = volumeData.c3[i];
                const avgPrice = volumeData.avgPrice[i];
                
                const totalHeight = (total / yMaxVolume) * 100;
                const c1Height = (c1 / total) * 100;
                const c2Height = (c2 / total) * 100;
                const c3Height = (c3 / total) * 100;

                const barHtml = `
                    <div class="flex-1 h-full text-center flex flex-col justify-end items-center chart-item" data-type="volume" data-month="${label}" data-total="${total}" data-c1="${c1}" data-c2="${c2}" data-c3="${c3}" data-avg-price="${avgPrice}">
                        <div class="w-3/5 h-full flex flex-col justify-end" style="height: ${totalHeight}%;">
                            <div class="chart-bar-stack" style="background-color: var(--light-lime); height: ${c3Height}%;"></div>
                            <div class="chart-bar-stack" style="background-color: var(--green); height: ${c2Height}%;"></div>
                            <div class="chart-bar-stack" style="background-color: var(--teal-green); height: ${c1Height}%;"></div>
                        </div>
                        <span class="text-sm font-semibold mt-2">${(i % 12) + 1}</span>
                    </div>
                `;
                volumeBarsContainer.innerHTML += barHtml;
            });


            // --- GRÁFICO DE PRECIOS ---
            const priceData = {
                labels: ["Ene-24", "Feb-24", "Mar-24", "Abr-24", "May-24", "Jun-24", "Jul-24", "Ago-24", "Sep-24", "Oct-24", "Nov-24", "Dic-24", "Ene-25", "Feb-25", "Mar-25", "Abr-25", "May-25", "Jun-25", "Jul-25", "Ago-25"],
                contrato: [437, 410, 415, 435, 437, 430, 439, 481, 588, 588, 619, 619, 775, 772, 772, 962, 1098, 1127, 1038, 994],
                exportacion: [0, 0, 0, 0, 170, 170, 185, 185, 220, 220, 220, 295, 300, 300, 300, 350, 350, 470, 470, 520],
                promedio: [437, 410, 415, 435, 391, 430, 423, 415, 535, 527, 619, 519, 586, 586, 542, 810, 915, 949, 757, 720]
            };

            const svg = document.getElementById('price-chart-svg');
            const chartContent = document.getElementById('price-chart-content');
            const labelsContainer = document.getElementById('price-chart-labels');

            const yMax = 1200;

            const createPath = (points) => {
                let d = `M ${points[0][0]} ${points[0][1]}`;
                for (let i = 0; i < points.length - 1; i++) {
                    const x_mid = (points[i][0] + points[i + 1][0]) / 2;
                    const y_mid = (points[i][1] + points[i + 1][1]) / 2;
                    const cp_x1 = (x_mid + points[i][0]) / 2;
                    const cp_x2 = (x_mid + points[i + 1][0]) / 2;
                    d += ` Q ${cp_x1}, ${points[i][1]}, ${x_mid}, ${y_mid}`;
                    d += ` Q ${cp_x2}, ${points[i + 1][1]}, ${points[i + 1][0]}, ${points[i + 1][1]}`;
                }
                return d;
            };
            
            const drawChart = () => {
                if (!svg || !chartContent || !labelsContainer) return;

                chartContent.innerHTML = ''; 
                labelsContainer.innerHTML = '';

                const width = svg.clientWidth;
                const height = svg.clientHeight;
                if (width === 0) return;
                
                const xStep = width / (priceData.labels.length - 1);

                const getCoords = (data) => data.map((value, i) => [i * xStep, height - (value / yMax * height)]);

                const contratoCoords = getCoords(priceData.contrato);
                const exportCoords = getCoords(priceData.exportacion);
                const promedioCoords = getCoords(priceData.promedio);

                const contratoPath = createPath(contratoCoords);
                const exportPath = createPath(exportCoords);
                const promedioPath = createPath(promedioCoords);

                let content = `
                    <path d="${contratoPath}" fill="none" stroke="var(--dark-blue)" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="${exportPath}" fill="none" stroke="var(--medium-green)" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="${promedioPath}" fill="none" stroke="var(--teal-blue)" stroke-width="3" stroke-dasharray="5,5" stroke-linecap="round" stroke-linejoin="round"/>
                `;

                contratoCoords.forEach((point, i) => {
                    content += `<circle class="price-line-chart-point" data-type="price" data-month="${priceData.labels[i]}" data-price-type="Contrato" data-price="$${priceData.contrato[i]}" cx="${point[0]}" cy="${point[1]}" r="6" fill="var(--dark-blue)" stroke="white" stroke-width="2"/>`;
                });
                
                exportCoords.forEach((point, i) => {
                    content += `<circle class="price-line-chart-point" data-type="price" data-month="${priceData.labels[i]}" data-price-type="Exportación" data-price="$${priceData.exportacion[i]}" cx="${point[0]}" cy="${point[1]}" r="6" fill="var(--medium-green)" stroke="white" stroke-width="2"/>`;
                });

                 promedioCoords.forEach((point, i) => {
                    content += `<circle class="price-line-chart-point" data-type="price" data-month="${priceData.labels[i]}" data-price-type="Promedio" data-price="$${priceData.promedio[i]}" cx="${point[0]}" cy="${point[1]}" r="6" fill="var(--teal-blue)" stroke="white" stroke-width="2"/>`;
                });

                chartContent.innerHTML = content;

                priceData.labels.forEach((label, i) => {
                    const monthNumber = (i % 12) + 1;
                    labelsContainer.innerHTML += `<span class="flex-1 text-center text-sm font-semibold">${monthNumber}</span>`;
                });
                addPriceChartEventListeners();
            };

            drawChart();
            window.addEventListener('resize', drawChart);
            
            function addPriceChartEventListeners(){
                 const pricePoints = document.querySelectorAll('.price-line-chart-point');
                 const tooltip = document.getElementById('chart-tooltip');
                 pricePoints.forEach(item => {
                    item.addEventListener('mousemove', (e) => {
                        const month = item.dataset.month;
                        const price = item.dataset.price;
                        const priceType = item.dataset.priceType;
                        const tooltipHtml = `
                            <div class="font-bold text-base text-center">${month}</div>
                            <div class="text-sm">${priceType}: ${price}</div>
                        `;
                        tooltip.innerHTML = tooltipHtml;
                        tooltip.style.opacity = '1';
                        tooltip.style.left = `${e.pageX}px`;
                        tooltip.style.top = `${e.pageY}px`;
                    });

                    item.addEventListener('mouseleave', () => {
                        tooltip.style.opacity = '0';
                    });
                });
            }


            // --- LÓGICA GENERAL DE TOOLTIPS (PARA OTROS GRÁFICOS) ---
            function addEventListeners() {
                const chartItems = document.querySelectorAll('.chart-item');
                const tooltip = document.getElementById('chart-tooltip');
                if (!chartItems.length || !tooltip) return;

                const colors = { c1: '#52b69a', c2: '#99d98c', c3: '#d9ed92' };

                chartItems.forEach(item => {
                    item.addEventListener('mousemove', (e) => {
                        const type = item.dataset.type;
                        const month = item.dataset.month;
                        let tooltipHtml = '';

                        if (type === 'volume') {
                            const total = item.dataset.total;
                            const c1 = item.dataset.c1;
                            const c2 = item.dataset.c2;
                            const c3 = item.dataset.c3;
                            const avgPrice = item.dataset.avgPrice;
                            tooltipHtml = `
                                <div class="font-bold text-base mb-2 text-center">${month}</div>
                                <div class="text-sm mb-1"><span class="inline-block w-3 h-3 rounded-sm mr-2" style="background-color: ${colors.c1};"></span>C. Barranca: ${parseInt(c1).toLocaleString('es-CO')} Ton</div>
                            `;
                            if (parseInt(c2) > 0) {
                                tooltipHtml += `<div class="text-sm mb-1"><span class="inline-block w-3 h-3 rounded-sm mr-2" style="background-color: ${colors.c2};"></span>C. Reficar: ${parseInt(c2).toLocaleString('es-CO')} Ton</div>`;
                            }
                            if (parseInt(c3) > 0) {
                                tooltipHtml += `<div class="text-sm"><span class="inline-block w-3 h-3 rounded-sm mr-2" style="background-color: ${colors.c3};"></span>Exportación: ${parseInt(c3).toLocaleString('es-CO')} Ton</div>`;
                            }
                            tooltipHtml += `
                                <hr class="my-2 border-gray-500">
                                <div class="text-sm font-bold">Total: ${parseInt(total).toLocaleString('es-CO')} Ton</div>
                                <div class="text-sm">Precio Prom: $${avgPrice}</div>
                            `;
                        } 

                        tooltip.innerHTML = tooltipHtml;
                        tooltip.style.opacity = '1';
                        tooltip.style.left = `${e.pageX}px`;
                        tooltip.style.top = `${e.pageY}px`;
                    });

                    item.addEventListener('mouseleave', () => {
                        tooltip.style.opacity = '0';
                    });
                });
            }
            addEventListeners();
        });
    </script>
</body>
</html>
